<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Facturas - SANITEX</title>
    
    <!-- Petite-Vue via CDN -->
    <script src="https://unpkg.com/petite-vue" defer init></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .report-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .page {
            width: 210mm;
            height: 297mm;
            padding: 15mm;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            position: relative;
            page-break-after: always;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            border-bottom: 2px solid #2c3e50;
            padding-bottom: 15px;
        }
        
        .company-info h1 {
            color: #2c3e50;
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .invoice-info {
            text-align: right;
        }
        
        .invoice-number {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .client-info, .company-details {
            margin-bottom: 20px;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .section-title {
            color: #2c3e50;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        th {
            background-color: #2c3e50;
            color: white;
            padding: 10px;
            text-align: left;
        }
        
        td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .totals {
            width: 250px;
            margin-left: auto;
        }
        
        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #ddd;
        }
        
        .total-final {
            font-weight: bold;
            font-size: 16px;
            color: #2c3e50;
            border-bottom: 2px solid #2c3e50;
        }
        
        .footer {
            position: absolute;
            bottom: 15mm;
            left: 15mm;
            right: 15mm;
            padding-top: 15px;
            border-top: 1px solid #ddd;
            text-align: center;
            color: #666;
            font-size: 12px;
        }
        
        .notes {
            margin-top: 15px;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .page-number {
            position: absolute;
            bottom: 5mm;
            right: 15mm;
            font-size: 12px;
            color: #666;
        }
        
        .controls {
            margin-bottom: 20px;
            text-align: center;
        }
        
        button {
            padding: 10px 20px;
            background-color: #2c3e50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 0 5px;
        }
        
        button:hover {
            background-color: #1a252f;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .page {
                box-shadow: none;
                margin-bottom: 0;
            }
            
            .controls {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="app" v-scope="MpreportPage()">
        <div class="controls">
            <button @click="addItem">Adicionar Item</button>
            <button @click="removeItem">Remover Item</button>
            <button @click="printReport">Imprimir</button>
        </div>
        
        <div class="report-container">
            <div v-for="(page, index) in pages" :key="index" class="page">
                <!-- Cabeçalho da página -->
                <div class="header">
                    <div class="company-info">
                        <h1>{{ company.name }}</h1>
                        <p>{{ company.description }}</p>
                        <p>{{ company.address }}</p>
                        <p>{{ company.city }}</p>
                        <p>Tel: {{ company.phone }} | Email: {{ company.email }}</p>
                        <p>NIF: {{ company.nif }}</p>
                    </div>
                    
                    <div class="invoice-info">
                        <div class="invoice-number">{{ invoice.number }}</div>
                        <p><strong>Data:</strong> {{ invoice.date }}</p>
                        <p><strong>Vencimento:</strong> {{ invoice.dueDate }}</p>
                    </div>
                </div>
                
                <!-- Informação do cliente (apenas na primeira página) -->
                <div v-if="index === 0" class="client-info">
                    <div class="section-title">CLIENTE</div>
                    <p><strong>Nome:</strong> {{ client.name }}</p>
                    <p><strong>Morada:</strong> {{ client.address }}</p>
                    <p><strong>Localidade:</strong> {{ client.city }}</p>
                    <p><strong>NIF:</strong> {{ client.nif }}</p>
                </div>
                
                <!-- Tabela de itens (parte específica de cada página) -->
                <table v-if="page.items.length > 0">
                    <thead>
                        <tr>
                            <th>Descrição</th>
                            <th>Quantidade</th>
                            <th>Preço Unitário</th>
                            <th>IVA</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="item in page.items" :key="item.id">
                            <td>{{ item.description }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>{{ formatCurrency(item.unitPrice) }}</td>
                            <td>{{ item.vat }}%</td>
                            <td>{{ formatCurrency(item.total) }}</td>
                        </tr>
                    </tbody>
                </table>
                
                <!-- Totais (apenas na última página) -->
                <div v-if="index === pages.length - 1" class="totals">
                    <div class="total-row">
                        <span>Subtotal:</span>
                        <span>{{ formatCurrency(subtotal) }}</span>
                    </div>
                    <div class="total-row">
                        <span>IVA ({{ vatRate }}%):</span>
                        <span>{{ formatCurrency(vatAmount) }}</span>
                    </div>
                    <div class="total-row total-final">
                        <span>TOTAL:</span>
                        <span>{{ formatCurrency(total) }}</span>
                    </div>
                </div>
                
                <!-- Observações (apenas na última página) -->
                <div v-if="index === pages.length - 1" class="notes">
                    <div class="section-title">OBSERVAÇÕES</div>
                    <p>{{ notes.paymentMethod }}</p>
                    <p>{{ notes.bankInfo }}</p>
                    <p>{{ notes.deliveryTime }}</p>
                </div>
                
                <!-- Rodapé da página -->
                <div class="footer">
                    <p>{{ company.name }} - {{ company.tagline }}</p>
                    <p>{{ company.thankYou }}</p>
                    <p>{{ company.website }} | {{ company.email }} | Tel: {{ company.phone }}</p>
                </div>
                
                <!-- Número da página -->
                <div class="page-number">Página {{ index + 1 }} de {{ pages.length }}</div>
            </div>
        </div>
    </div>

    <script>
        function MpreportPage() {
            return {
                // Dados da empresa
                company: {
                    name: "SANITEX",
                    description: "Especialistas em Soluções Sanitárias",
                    address: "Rua da Indústria, 123",
                    city: "2400-000 Leiria",
                    phone: "244 123 456",
                    email: "info@sanitex.pt",
                    nif: "123 456 789",
                    tagline: "Soluções em Equipamentos Sanitários",
                    thankYou: "Obrigado pela sua preferência!",
                    website: "www.sanitex.pt"
                },
                
                // Dados da fatura
                invoice: {
                    number: "FACTURA #2024/001",
                    date: "20 de Maio de 2024",
                    dueDate: "20 de Junho de 2024"
                },
                
                // Dados do cliente
                client: {
                    name: "João Silva Lda.",
                    address: "Av. Central, 45",
                    city: "2400-100 Leiria",
                    nif: "987 654 321"
                },
                
                // Observações
                notes: {
                    paymentMethod: "Pagamento por transferência bancária para:",
                    bankInfo: "IBAN: PT50 0000 0000 0000 0000 0000 0",
                    deliveryTime: "Prazo de entrega: 5 dias úteis após confirmação de pagamento"
                },
                
                // Itens da fatura
                items: [
                    { id: 1, description: "Lavabos modernos - Modelo Lux", quantity: 2, unitPrice: 150.00, vat: 23, total: 300.00 },
                    { id: 2, description: "Sanita suspensa - EcoSave", quantity: 3, unitPrice: 89.90, vat: 23, total: 269.70 },
                    { id: 3, description: "Misturador cromado - Serie Pro", quantity: 5, unitPrice: 45.00, vat: 23, total: 225.00 },
                    { id: 4, description: "Instalação e montagem", quantity: 1, unitPrice: 120.00, vat: 23, total: 120.00 },
                    { id: 5, description: "Banheira de hidromassagem - Premium", quantity: 1, unitPrice: 850.00, vat: 23, total: 850.00 },
                    { id: 6, description: "Box de duche - Cristal 8mm", quantity: 2, unitPrice: 320.00, vat: 23, total: 640.00 },
                    { id: 7, description: "Móvel de lavatório - Carvalho", quantity: 1, unitPrice: 280.00, vat: 23, total: 280.00 },
                    { id: 8, description: "Espelho iluminado LED", quantity: 3, unitPrice: 75.00, vat: 23, total: 225.00 },
                    { id: 9, description: "Acessórios de banho - Conjunto", quantity: 4, unitPrice: 35.00, vat: 23, total: 140.00 },
                    { id: 10, description: "Cortina de banho - Design", quantity: 2, unitPrice: 42.50, vat: 23, total: 85.00 }
                ],
                
                // Taxa de IVA
                vatRate: 23,
                
                // Páginas do relatório
                pages: [],
                
                // Inicialização
                async $init() {
                    this.calculatePages();
                },
                
                // Calcular páginas com base no conteúdo
                calculatePages() {
                    this.pages = [];
                    
                    // Altura disponível para conteúdo em cada página (em mm)
                    const pageHeight = 297; // Altura A4
                    const margins = 30; // Margens superior e inferior
                    const headerHeight = 80; // Altura estimada do cabeçalho
                    const footerHeight = 50; // Altura estimada do rodapé
                    const clientInfoHeight = 20; // Altura da info do cliente (apenas primeira página)
                    const totalsHeight = 20; // Altura dos totais (apenas última página)
                    const notesHeight = 20; // Altura das observações (apenas última página)
                    
                    const availableHeightFirstPage = pageHeight - margins - headerHeight - footerHeight - clientInfoHeight;
                    const availableHeightOtherPages = pageHeight - margins - headerHeight - footerHeight;
                    
                    // Altura estimada por linha da tabela (em mm)
                    const rowHeight = 8;
                    
                    // Altura da tabela com cabeçalho
                    const tableHeaderHeight = 15;
                    
                    let currentPageItems = [];
                    let currentPageHeight = 0;
                    let isFirstPage = true;
                    
                    for (let i = 0; i < this.items.length; i++) {
                        const item = this.items[i];
                        
                        // Verificar se o item cabe na página atual
                        const itemHeight = rowHeight;
                        const maxHeight = isFirstPage ? availableHeightFirstPage : availableHeightOtherPages;
                        
                        if (currentPageHeight + itemHeight + (currentPageItems.length === 0 ? tableHeaderHeight : 0) <= maxHeight) {
                            currentPageItems.push(item);
                            currentPageHeight += itemHeight;
                            if (currentPageItems.length === 1) {
                                currentPageHeight += tableHeaderHeight;
                            }
                        } else {
                            // Adicionar página atual
                            this.pages.push({
                                items: [...currentPageItems],
                                isFirst: isFirstPage,
                                isLast: false
                            });
                            
                            // Iniciar nova página
                            currentPageItems = [item];
                            currentPageHeight = tableHeaderHeight + itemHeight;
                            isFirstPage = false;
                        }
                    }
                    
                    // Adicionar última página
                    if (currentPageItems.length > 0) {
                        this.pages.push({
                            items: [...currentPageItems],
                            isFirst: isFirstPage,
                            isLast: true
                        });
                    }
                    
                    // Atualizar flags de primeira e última página
                    if (this.pages.length > 0) {
                        this.pages[0].isFirst = true;
                        this.pages[this.pages.length - 1].isLast = true;
                        
                        for (let i = 1; i < this.pages.length - 1; i++) {
                            this.pages[i].isFirst = false;
                            this.pages[i].isLast = false;
                        }
                    }
                },
                
                // Adicionar item
                addItem() {
                    const newId = this.items.length > 0 ? Math.max(...this.items.map(item => item.id)) + 1 : 1;
                    this.items.push({
                        id: newId,
                        description: "Novo produto/serviço",
                        quantity: 1,
                        unitPrice: 0,
                        vat: this.vatRate,
                        total: 0
                    });
                    this.calculatePages();
                },
                
                // Remover último item
                removeItem() {
                    if (this.items.length > 0) {
                        this.items.pop();
                        this.calculatePages();
                    }
                },
                
                // Imprimir relatório
                printReport() {
                    window.print();
                },
                
                // Formatar moeda
                formatCurrency(value) {
                    return new Intl.NumberFormat('pt-PT', {
                        style: 'currency',
                        currency: 'EUR'
                    }).format(value);
                },
                
                // Calcular subtotal
                get subtotal() {
                    return this.items.reduce((sum, item) => sum + item.total, 0);
                },
                
                // Calcular valor do IVA
                get vatAmount() {
                    return this.subtotal * (this.vatRate / 100);
                },
                
                // Calcular total
                get total() {
                    return this.subtotal + this.vatAmount;
                }
            };
        }
    </script>
</body>
</html>